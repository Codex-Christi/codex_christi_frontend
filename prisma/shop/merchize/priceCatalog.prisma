// prisma/shop/merchize/priceCatalog.prisma
datasource db {
  provider = "sqlite"
  // URL is now set in prisma.config.ts (Prisma 7 style)
}

generator merchizeCatalogClient {
  provider = "prisma-client"
  // from prisma/shop/merchize → up to project root → into src/generated/merchizeCatalog
  output   = "../../../src/lib/prisma/shop/merchize/generated/merchizeCatalog"
}

model Product {
  id             String    @id @default(cuid())
  merchizeId     String    @unique
  skuPrefix      String?
  title          String?
  slug           String?
  thumbUrl       String?
  fulfillCode    String?
  fulfillName    String?
  productionMin  Int?
  productionMax  Int?
  printingJson   Json?
  attributesJson Json?
  mockupUrl      String?

  variants       Variant[]

  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([skuPrefix])
  @@index([fulfillCode])
}

model Variant {
  id         String   @id @default(cuid())
  merchizeId String   @unique
  sku        String   @unique
  productId  String
  product    Product  @relation(fields: [productId], references: [id])

  attributesJson Json?
  tiersJson      Json?

  tier1Price     Float?
  tier2Price     Float?
  tier3Price     Float?

  shippingBands  ShippingBand[]

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([sku])
}

model ShippingBand {
  id         String  @id @default(cuid())
  variantId  String
  variant    Variant @relation(fields: [variantId], references: [id])

  toZone     String
  firstItem  Float?
  addlItem   Float?

  @@unique([variantId, toZone])
  @@index([toZone])
}

model SyncState {
  id            String   @id @default("merchize_catalog")
  lastPage      Int      @default(0)
  lastTotal     Int      @default(0)
  lastRunAt     DateTime @default(now())
  lastSuccessAt DateTime?
}